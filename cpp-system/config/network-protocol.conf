# Network Protocol Optimization Configuration

[http_parser]
# HTTP/1.1 parser settings
max_header_size = 8192
max_body_size = 1048576  # 1MB
enable_simd_optimization = true
enable_zero_copy = true

# HTTP/2 parser settings
enable_http2 = true
max_frame_size = 16384
max_header_list_size = 8192
initial_window_size = 65535
enable_server_push = true

[tcp_connection]
# TCP connection optimization
enable_reuseport = true
enable_nodelay = true
enable_keepalive = true
keepalive_idle = 7200      # seconds
keepalive_interval = 75    # seconds
keepalive_probes = 9       # count
send_buffer_size = 65536   # bytes
recv_buffer_size = 65536   # bytes
connect_timeout_ms = 5000  # milliseconds
enable_fast_open = true
enable_defer_accept = true

[connection_pool]
# Connection pool settings
max_connections_per_worker = 10000
worker_threads = 0  # 0 = auto-detect CPU cores
connection_timeout_ms = 30000
keepalive_interval_ms = 5000
enable_connection_reuse = true
enable_pipelining = false

[load_balancer]
# Load balancing algorithm
algorithm = "consistent_hash"  # round_robin, weighted_round_robin, least_connections, consistent_hash, etc.
virtual_nodes_per_backend = 160
enable_health_checks = true
enable_session_affinity = false
session_cookie_name = "SESSIONID"
session_timeout_ms = 1800000  # 30 minutes

[health_checker]
# Health check configuration
type = "tcp_connect"  # tcp_connect, http_get, http_post, custom
path = "/health"
expected_response = "OK"
timeout_ms = 5000
interval_ms = 30000
unhealthy_threshold = 3
healthy_threshold = 2

[dpdk]
# DPDK network configuration
enable_dpdk = true
port_mask = 0x1
rx_ring_size = 2048
tx_ring_size = 2048
num_mbufs = 16383
mbuf_cache_size = 512
burst_size = 64
enable_rss = true
enable_checksum_offload = true
enable_tso = true
mtu = 1500

# RSS hash functions (bitwise OR)
# ETH_RSS_IP = 0x1, ETH_RSS_TCP = 0x2, ETH_RSS_UDP = 0x4
rss_hash_functions = 0x7  # IP + TCP + UDP

[performance]
# Performance optimization settings
enable_interrupt_mode = false
stats_update_interval_ms = 1000
enable_prefetch = true
cpu_affinity = true
numa_aware = true

# Packet processing
max_packet_burst = 64
packet_processing_timeout_us = 100

[security]
# Security and filtering
enable_firewall = false
enable_ddos_protection = true
max_global_connections = 100000
connection_limit_per_ip = 1000
rate_limit_per_ip = 10000  # connections per second
blacklist_threshold = 100  # failed connections before blacklist
blacklist_duration_ms = 300000  # 5 minutes

[monitoring]
# Monitoring and metrics
enable_prometheus_metrics = true
prometheus_port = 9090
enable_hardware_counters = true
enable_latency_histograms = true
metrics_collection_interval_ms = 1000

# Log levels: trace, debug, info, warn, error, critical
log_level = "info"
enable_structured_logging = true